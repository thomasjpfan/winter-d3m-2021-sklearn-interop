<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.75.1"><meta charset=utf-8><title>Scikit-learn D3M Interop</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=/winter-d3m-2020-sklearn-interop/reveal-js/css/reset.css><link rel=stylesheet href=/winter-d3m-2020-sklearn-interop/reveal-js/css/reveal.css><link rel=stylesheet href=/winter-d3m-2020-sklearn-interop/_.min.8dd66bfde90c8f066cab2c5dcd63eb6d12857a9d0c33e2f2f97e57cf9db39c36.css id=theme><link rel=stylesheet href=/winter-d3m-2020-sklearn-interop/highlight-js/monokai-sublime.min.css></head><body><div class=reveal><div class=slides><section><h1 id=scikit-learn-d3m-interop>Scikit-learn D3M Interop</h1><div class="g g-middle"><div class=g-1><figure><img src=images/d3m2.png height=240px></figure></div><div class=g-1><figure><img src=images/scikit-learn-logo.png height=240px></figure></div><div class=g-1><figure><img src=images/columbia.jpeg height=240px></figure></div></div><h2 id=winter-2021>Winter 2021</h2><h3 id=thomas-j-fan--columbia-university><strong>Thomas J. Fan @ Columbia University</strong></h3></section><section><h1 id=main-goal>Main Goal</h1><h2 id=auto-generate-a-d3m-primitive-from-any-scikit-learn-compatible-estimator>Auto-generate a D3M Primitive from <strong>ANY</strong> Scikit-learn compatible estimator</h2></section><section><h1 id=high-level-overview>High Level Overview</h1><ol><li>Library author already has a scikit-learn compatible estimator</li><li><span class=fragment>Contributor using D3M's framework wants to add primitive</span></li><li><span class=fragment>Contributor writes the types for hyper-parameter and attributes</span></li><li><span class=fragment>Contributor adds additional Metadata if necessary</span></li><li><span class=fragment>Run auto-generation script developed by D3M to generate primitive</span></li></ol></section><section><h1 id=goal>Goal</h1><p><strong>Provide a CLI tool</strong></p><pre><code class=language-bash>pip install d3m_estimator_to_primitive

d3m_estimator_to_primitive --meta additional_metadata.json xgboost.XGBClassifier
</code></pre><p>would generate a <code>XGBClassifierPrimitive.py</code></p><h2 id=allow-any-scikit-learn-compatible-estimator-be-a-primitive><strong>Allow ANY Scikit-learn compatible estimator be a primitive</strong></h2></section><section><h1 id=what-has-been-developed>What has been developed?</h1><ul><li>We already have some of this work in <strong>sklearn-wrap</strong></li><li>How do we leverage this code?</li></ul></section><section><h2 id=1--library-author-already-has-a-scikit-learn-compatible-estimator>1. ✅ Library author already has a scikit-learn compatible estimator</h2><h2 id=2--contributor-using-d3ms-framework-wants-to-add-primitive>2. ✅ Contributor using D3M&rsquo;s framework wants to add primitive</h2></section><section><section data-shortcode-section><h1 id=3-contributor-writes-the-types-for-hyper-parameter-and-attributes>3. Contributor writes the types for hyper-parameter and attributes</h1></section><section><h1 id=metadata-using-python-typing>Metadata using Python Typing</h1><h3 id=githubcomthomasjpfansk-typinghttpsgithubcomthomasjpfansk-typing><a href=https://github.com/thomasjpfan/sk-typing>github.com/thomasjpfan/sk-typing</a></h3><pre><code class=language-python>class KMeans:

    cluster_centers_: np.ndarray
    labels_: np.ndarray
    inertia_: float
    n_iter_: int

    def __init__(
        self,
        n_clusters: int = 8,
        init: Union[Literal[&quot;k-means++&quot;, &quot;random&quot;], Callable, ArrayLike] = &quot;k-means++&quot;,
        ...
</code></pre></section><section><h1 id=converts-to-a-json-format-for-sklearn_wrap>Converts to a json format for sklearn_wrap</h1><pre><code class=language-json>  &quot;KMeans&quot;: {
    &quot;name&quot;: &quot;sklearn.cluster._kmeans.KMeans&quot;,
    &quot;common_name&quot;: &quot;KMeans&quot;,
    &quot;description&quot;: &quot;K-Means clustering. Read more in the :ref:`User Guide &lt;k_means&gt;`.&quot;,
    &quot;sklearn_version&quot;: &quot;0.22.2.post1&quot;,
    &quot;Hyperparams&quot;: [
      {
        &quot;type&quot;: &quot;Hyperparameter&quot;,
        &quot;name&quot;: &quot;n_clusters&quot;,
        &quot;init_args&quot;: {
          &quot;semantic_types&quot;: [
            &quot;n_clusters&quot;
          ],
          &quot;_structural_type&quot;: &quot;int&quot;,
          &quot;default&quot;: 8,
          &quot;description&quot;: &quot;The number of clusters to form as well as the number of centroids to generate.&quot;
        }
      },
</code></pre></section></section><section><section data-shortcode-section><h1 id=4-contributor-adds-additional-metadata-if-necessary>4. Contributor Adds Additional metadata if necessary</h1><h3 id=we-should-keep-this-at-to-a-minimum><strong>We should keep this at to a minimum</strong></h3></section><section><h1 id=additional-metadata-we-need-now>Additional metadata we need now:</h1><ul><li>Specify hyperparams_to_tune</li><li><strong>Private attributes</strong></li></ul></section><section><h1 id=specify-hyperparameters_to_tune>Specify <code>hyperparameters_to_tune</code></h1><ul><li>Unless library authors specify this, the D3M contributor would have to</li><li>Tuning and Control Parameters</li><li>This can be another barrier</li></ul></section><section><h1 id=private-attributes->Private attributes !</h1><h4 id=example-skkneighborsclassifier>Example: <code>SKKNeighborsClassifier</code></h4><pre><code class=language-python>class Params(params.Params):

    _fit_method: Optional[str]
    n_samples_fit_: Optional[int]
    _fit_X: Optional[ndarray]
    _tree: Optional[object]
    ...
</code></pre><ul><li>Attributes starting with <code>_</code> are undocumented.</li><li>Brittle: private attributes can change without warning</li><li>Providing this metadata requires one to dive into the source code</li><li>Huge barrier for creating primitives</li></ul></section><section><h1 id=why-do-we-have-this>Why do we have this?</h1><p>D3M uses <code>set_params</code> and <code>get_params</code> to serialized and deserialize the primitive</p><pre><code class=language-python>    def set_params(self, *, params: Params) -&gt; None:
        ...

    def get_params(self) -&gt; Params:
        ...
</code></pre></section><section><h1 id=possible-solution>Possible Solution</h1><ul><li>Treat the estimator like a semi-transparent box</li><li>Provide access to the public attributes</li><li>This is how it works for <code>xgboost</code> and <code>lightgbm</code>&rsquo;s boosters in the <code>common-primitives</code></li></ul><pre><code class=language-python>self._learner.set_params(_Booster=params['booster'], n_classes_=params['n_classes'],
</code></pre></section></section><section><section data-shortcode-section><h1 id=ongoing-work>Ongoing Work</h1><ul><li>Trying to reuse as much as possible from <code>sklearn-wrap</code></li><li><strong>Rewrite some of sklearn-wrap to not depend on private attributes</strong></li><li><code>sk-typing</code> does not contain bounds<ul><li>Can be added with Python&rsquo;s <code>Annotated</code> but may introduce more difficult</li></ul></li></ul></section><section><h1 id=goal>Goal</h1><p><strong>Provide a CLI tool</strong></p><pre><code class=language-bash>pip install d3m_estimator_to_primitive

d3m_estimator_to_primitive --meta additional_metadata.json xgboost.XGBClassifier
</code></pre><p>would generate a <code>XGBClassifierPrimitive.py</code></p><h2 id=allow-any-scikit-learn-compatible-estimator-be-a-primitive><strong>Allow ANY Scikit-learn compatible estimator be a primitive</strong></h2></section></section><section><section data-shortcode-section><h1 id=future-extensions-extra-slides>Future extensions (EXTRA SLIDES)</h1></section><section><h1 id=sksearchspace>sksearchspace</h1><h3 id=githubcomthomasjpfansksearchspacehttpsgithubcomthomasjpfansksearchspace><a href=https://github.com/thomasjpfan/sksearchspace>github.com/thomasjpfan/sksearchspace</a></h3><blockquote><p>Scikit-learn Search Space Configurations with curated search spaces for scikit-learn estimators.</p></blockquote></section><section><h1 id=sksearchspace-1>sksearchspace</h1><p>sksearchspace uses ConfigSpace for sampling.</p><pre><code class=language-python data-line-numbers=1-4|6-7>from sksearchspace import SearchSpace
from sklearn.tree import DecisionTreeClassifier

estimator_space = SearchSpace.for_sklearn_estimator(DecisionTreeClassifier, seed=42)

estimator_space.sample()
# {'criterion': 'entropy','min_samples_leaf': 15, 'min_samples_split': 11}
</code></pre></section><section><h1 id=search-spaces-in-ml>Search spaces in ML</h1><p>ML ecosystem has many frameworks for defining spaces</p><ul><li>ray tune - <a href=https://docs.ray.io/en/master/tune/index.html>https://docs.ray.io/en/master/tune/index.html</a></li><li>keras-tuner - <a href=https://keras-team.github.io/keras-tuner/>https://keras-team.github.io/keras-tuner/</a></li><li>ConfigSpace - <a href=https://automl.github.io/ConfigSpace/master/>https://automl.github.io/ConfigSpace/master/</a></li><li>scikit-learn - uses dicts + scipy distributions</li></ul><h3 id=requires-tool-to-translate-to-d3m-hyperparmaters>Requires tool to translate to D3M hyperparmaters</h3></section></section></div></div><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-hugo/object-assign.js></script><a href=/winter-d3m-2020-sklearn-interop/reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById('print-location');var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css');document.getElementsByTagName('head')[0].appendChild(link);</script><script type=application/json id=reveal-hugo-site-params>{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"height":720,"highlight_theme":"monokai-sublime","transition_speed":"fast","width":1280}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=/winter-d3m-2020-sklearn-interop/reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(map){if(map){Object.keys(map).forEach(function(k){newK=k.replace(/(\_\w)/g,function(m){return m[1].toUpperCase()});if(newK!=k){map[newK]=map[k];delete map[k];}});}
return map;}
var revealHugoDefaults={center:true,controls:true,history:true,progress:true,transition:"slide"};var revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);var revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);var options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options);</script><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=/winter-d3m-2020-sklearn-interop/reveal-js/plugin/notes/notes.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://thomasjpfan.github.io/winter-d3m-2020-sklearn-interop//javascript/tex-svg.js></script><link rel="shortcut icon" href=https://thomasjpfan.github.io/winter-d3m-2020-sklearn-interop//favicon.ico></body></html>